{% extends 'storage_rental/base.html' %}
{% load static %}

{% block header %}
<script src="https://unpkg.com/react@17/umd/react.production.min.js"
    crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"
    crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<title>Self Storage - Аренда боксов</title>
{% endblock %}

{% block content %}
<div class="container">
    <br />
    <h1>Аренда бокса</h1>
    <br />
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-outline-dark" type="submit">Арендовать</button>
    </form>

    <div id="app" width="100%"></div>

    <script type="text/babel">

        const App = () => {
            const all_storages = JSON.parse("{{ storages|escapejs }}");

            const [selectedStorage, setSelectedStorage] = React.useState();
            const [size, setSize] = React.useState(1);
            const [duration, setDuration] = React.useState(1);
            const [totalPrice, setTotalPrice] = React.useState(0);

            React.useEffect(() => {
                let storage = all_storages[selectedStorage]
                if (storage) {
                    let base_price = storage.base_price
                    let additional_price = storage.additional_price

                    setTotalPrice(duration * (base_price + additional_price * (size - 1)))
                }
                else {
                    setTotalPrice(0)
                }
            }, [selectedStorage, size, duration]);

            const storageEl = document.querySelector("#storage");
            storageEl.addEventListener("change", () => {
                setSelectedStorage(storageEl.value);
            });

            const sizeEl = document.querySelector("#size");
            sizeEl.addEventListener("change", () => {
                setSize(sizeEl.value || 0)
            });

            const durationEl = document.querySelector("#duration");
            durationEl.addEventListener("change", () => {
                setDuration(durationEl.value || 0)
            });

            return (
                <div>
                    <strong><p class="mt-3">Итоговая сумма: {totalPrice}</p></strong>
                </div>
            );
        }

        ReactDOM.render(<App />, document.querySelector("#app"));
    </script>
</div>
{% endblock %}