{% extends 'storage_rental/base.html' %}
{% load static %}

{% block header %}
<title>Self Storage - Аренда боксов</title>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="my-4">Аренда бокса</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button class="btn btn-outline-dark my-3" type="submit">
            Арендовать
        </button>
    </form>

    <br>
    <p class="mt-1 mb-3">
        <strong>Итоговая сумма: <span id="totalPrice">0</span>
    </p>

    <script>
        const allStorages = JSON.parse("{{ storages|escapejs }}");

        const storageEl = document.querySelector("#storage");
        const sizeEl = document.querySelector("#size");
        const durationEl = document.querySelector("#duration");
        const totalPriceEl = document.querySelector("#totalPrice");

        [storageEl, sizeEl, durationEl].forEach(item => {
            item.addEventListener('change', event => {
                recalculateTotalPrice();
            })
        })

        const recalculateTotalPrice = () => {
            let storage = allStorages[storageEl.value]
            let size = sizeEl.value

            if (storage && size != 0) {
                let basePrice = storage.base_price
                let additionalPrice = storage.additional_price
                let duration = durationEl.value || 0

                totalPriceEl.innerHTML = duration * (basePrice + additionalPrice * (size - 1))
            }
            else {
                totalPriceEl.innerHTML = 0
            }
        }
    </script>
</div>
{% endblock %}